{# Base/partials/changelog_modal.html #}
{% comment %}
Incluir asÃ­ (puedes ajustar la versiÃ³n y el tÃ­tulo):
{% include 'Base/partials/changelog_modal.html' with changelog_version='1.3.0' changelog_title='Novedades â€” v1.3.0 (19 Ago 2025)' %}

Reglas:
- Cambia `changelog_version` en cada release (p. ej. '1.3.0'). Si cambia, el modal vuelve a mostrarse una vez.
- Edita el contenido de <ul> con tus cambios.
- Requiere Bootstrap 5 JS cargado en la base.
{% endcomment %}

<div class="modal fade" id="changelogModal" tabindex="-1" aria-labelledby="changelogLabel" aria-hidden="true"
     data-bs-backdrop="static">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">

            <!-- Header -->
            <div class="modal-header">
                <div>
                    <h5 class="modal-title d-flex align-items-center gap-2" id="changelogLabel">
                        {{ changelog_title|default:"Novedades de la plataforma" }}
                        <span class="badge text-white" style="background-color:#1CC88A;">{{ changelog_version|default:"v1.0.0" }}</span>
                    </h5>

                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>

            <!-- Body -->
            <div class="modal-body">
                <p class="mb-3">Esto es lo mÃ¡s reciente que incorporamos. Â¡Gracias por tus comentarios! ğŸ™Œ</p>

                <!-- Novedades -->
                <h6 class="mb-2">Novedades</h6>
                <div class="list-group list-group-flush mb-3">
                    <div class="list-group-item d-flex align-items-start gap-2">
                        <span>âœ…</span>
                        <div>Modal de confirmaciÃ³n en entradas y salidas que recorre todas las pÃ¡ginas de DataTables.
                        </div>
                    </div>
                    <div class="list-group-item d-flex align-items-start gap-2">
                        <span>ğŸ””</span>
                        <div>Notificaciones centralizadas con Notyf mediante <em>include</em> reutilizable.</div>
                    </div>
                </div>

                <!-- Mejoras -->
                <h6 class="mb-2">Mejoras</h6>
                <div class="list-group list-group-flush mb-3">
                    <div class="list-group-item d-flex align-items-start gap-2">
                        <span>ğŸ”</span>
                        <div>BÃºsqueda y paginaciÃ³n optimizadas en tablas de inventario.</div>
                    </div>
                    <div class="list-group-item d-flex align-items-start gap-2">
                        <span>âš™ï¸</span>
                        <div>Validaciones mÃ¡s claras en formularios y manejo de errores.</div>
                    </div>
                </div>

                <!-- Correcciones -->
                <h6 class="mb-2">Correcciones</h6>
                <div class="list-group list-group-flush">
                    <div class="list-group-item d-flex align-items-start gap-2">
                        <span>ğŸ”’</span>
                        <div>Ajustes de seguridad menores y saneamiento de entradas.</div>
                    </div>
                </div>


            </div>

            <!-- Footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" id="changelogLaterBtn">
                    Ver mÃ¡s tarde
                </button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="changelogOkBtn">
                    Entendido
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    (function () {
        // VersiÃ³n actual del changelog (si no pasas variable, usa un default)
        const VERSION = "{{ changelog_version|default:'1.0.0' }}";
        const STORAGE_KEY = "osmit_changelog_shown_" + VERSION;

        // Si ya se mostrÃ³ esta versiÃ³n, no abrir
        if (localStorage.getItem(STORAGE_KEY)) return;

        // Requiere Bootstrap 5
        const modalEl = document.getElementById('changelogModal');
        if (!modalEl || typeof bootstrap === 'undefined' || !bootstrap.Modal) return;

        const modal = new bootstrap.Modal(modalEl, {backdrop: true, keyboard: true});
        modal.show();

        // â€œEntendidoâ€ => marcar como visto esta versiÃ³n (ya no volverÃ¡ a salir)
        document.getElementById('changelogOkBtn')?.addEventListener('click', function () {
            localStorage.setItem(STORAGE_KEY, '1');
        });

        // â€œVer mÃ¡s tardeâ€ => NO guardamos nada; volverÃ¡ a salir hasta que se presione â€œEntendidoâ€
    })();
</script>
